---
title: "swd2"
author: "Michael Škvrňák"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)

library(dplyr)
library(targets)
library(sjPlot)
library(modelsummary)

```

```{r}
tar_load(all_panels)
```

# Hypotheses from pre-analysis plan

- Hypothesis 1: Pre-Election satisfaction does not matter for participation when socio-demographic controls and other attitudinal drivers of participation are controlled for.  
- Hypothesis 2: Voter Turnout is more strongly associated with post-election satisfaction than pre-election satisfaction.  
- Hypothesis 3: Elections increase satisfaction with democracy among voters, but exert no effect on abstainers.  
- Hypothesis 4: The strongest increase is among those, whose preferred candidates qualified for the 2nd round (1st round of voting) or won the second round (2nd round of voting).  
- Hypothesis 5: The effect of winning is stronger for respondents with stable preferences.  

## H1
```{r}
lm1_1 <- glm(voted ~ swd_pre + factor(election), 
             data = all_panels, 
             family = binomial(link = "logit"))

# lm1_2 <- glm(voted ~ swd_pre + age + I(age^2) + female + 
#                  postsecondary_edu +
#                  party_close + 
                 # factor(election), data = all_panels)

# lm1_3 <- glm(voted ~ swd_pre + age + I(age^2) + female + 
#                  postsecondary_edu +
#                  pol_knowledge_pct + 
#                  party_close + 
#                  factor(election), data = all_panels)

lm1_4 <- glm(voted ~ swd_pre + age + I(age^2) + female + 
                 postsecondary_edu +
                 pol_interest_num + 
                 party_close + 
                 factor(election), data = all_panels, 
             family = binomial(link = "logit"))

create_fe_row <- function(coefs, n_models = 2){
    new_rows <- tibble(
        term = "Election FE", 
        models = rep("Yes", times = n_models),
        name = paste0("Model ", 1:n_models)
    ) %>% tidyr::pivot_wider(., id_cols = "term", 
                             names_from = name, values_from = models)
    
    attr(new_rows, "position") <- (length(coefs) * 2) + 1
    new_rows
}

coefs1 <- c(
    "(Intercept)"="(Intercept)", 
    "swd_pre"="Satisfaction w/ democracy (pre-election wave)", 
    "age" = "Age", 
    "I(age^2)" = "Age (squared)", 
    "female" = "Female", 
    "postsecondary_edu" = "Postsecondary education", 
    "pol_interest_num" = "Political interest",
    "party_close" = "Close to a party"
)
# tab_model(list(lm1_1, lm1_4))
new_rows <- create_fe_row(coefs1, 2)

modelsummary(
    list(lm1_1, lm1_4), 
    coef_map = coefs1, 
    add_rows = new_rows, 
    fmt = 2, stars = TRUE
)
```

## H2
```{r}
lm2_2 <- glm(voted ~ swd_post + age + I(age^2) + female + 
                 postsecondary_edu +
                 party_close + 
                 factor(election), 
             family = binomial(link = "logit"),
             data = all_panels)

lm2_3 <- glm(voted ~ swd_post + swd_pre + age + I(age^2) + female + 
                 postsecondary_edu +
                 pol_interest_num + 
                 party_close + 
                 factor(election), 
             family = binomial(link = "logit"),
             data = all_panels)

coefs2 <- c(
    "(Intercept)"="(Intercept)", 
    "swd_post"="Satisfaction w/ democracy (post-election wave)", 
    "swd_pre"="Satisfaction w/ democracy (pre-election wave)",
    "age" = "Age", 
    "I(age^2)" = "Age (squared)", 
    "female" = "Female", 
    "postsecondary_edu" = "Postsecondary education", 
    "pol_interest_num" = "Political interest", 
    "party_close" = "Close to a party"
)
new_rows <- create_fe_row(coefs2, 2)

modelsummary(list(lm2_2, lm2_3), coef_map = coefs2, 
             add_rows = new_rows, fmt = 2, stars = TRUE)
```

## H3
```{r}
lm3_1 <- lm(swd_diff ~ voted + swd_pre + age + I(age^2) + female + 
                 postsecondary_edu +
                 party_close + 
                 factor(election), data = all_panels)

lm3_2 <- lm(swd_diff ~ voted + swd_pre + age + I(age^2) + female + 
                 postsecondary_edu +
                 party_close + 
                 pol_interest_num + 
                 factor(election), data = all_panels)

# lm3_3 <- lm(swd_diff ~ voted + swd_pre + age + I(age^2) + female + 
#                  postsecondary_edu +
#                  party_close + 
#                  pol_knowledge_pct + 
#                  factor(election), data = all_panels)

coefs3 <- c(
    "(Intercept)"="(Intercept)", 
    "voted" = "Voted in the election",
    "swd_pre"="Satisfaction w/ democracy (pre-election wave)", 
    "age" = "Age", 
    "I(age^2)" = "Age (squared)", 
    "female" = "Female", 
    "postsecondary_edu" = "Postsecondary education", 
    "party_close" = "Close to a party",
    "pol_interest_num" = "Political interest"
)
new_rows3 <- create_fe_row(coefs3, 2)

modelsummary(list(lm3_1, lm3_2), coef_map = coefs3, add_rows = new_rows3, fmt = 2, stars = TRUE)
```

## H4

Data only from Romanian presidential election, no fixed effects.
```{r}
lm4_1 <- lm(swd_diff ~ candidate_qualified_2nd + swd_pre + 
                age + I(age^2) + female + 
                postsecondary_edu +
                party_close + pol_interest_num, 
               data = all_panels)
lm4_2 <- lm(swd_diff ~ candidate_qualified_2nd + winner + swd_pre + 
                age + I(age^2) + female + 
                postsecondary_edu +
                party_close + pol_interest_num, 
               data = all_panels)

coefs4 <- c(
    "(Intercept)"="(Intercept)", 
    "candidate_qualified_2nd" = "Preferred candidate qualified to 2nd round",
    "winner" = "Preferred candidate won election",
    "swd_pre"="Satisfaction w/ democracy (pre-election wave)", 
    "age" = "Age", 
    "I(age^2)" = "Age (squared)", 
    "female" = "Female", 
    "postsecondary_edu" = "Postsecondary education", 
    "party_close" = "Close to a party",
    "pol_interest_num" = "Political interest"
)
# new_rows4 <- create_fe_row(coefs4, 2)

modelsummary(list(lm4_1, lm4_2), coef_map = coefs4, fmt = 2, stars = TRUE)

```

## H5
```{r}
lm5_0 <- lm(swd_diff ~ winner + stable_voter + swd_pre +
                age + I(age^2) + female + 
                postsecondary_edu +
                party_close + 
                pol_interest_num + 
                factor(election), 
            data = all_panels)
lm5_1 <- lm(swd_diff ~ winner * stable_voter + swd_pre + 
                age + I(age^2) + female + 
                postsecondary_edu +
                party_close + 
                pol_interest_num + 
                factor(election), 
            data = all_panels)
lm5_2 <- lm(swd_diff ~ winner * stable_intention + swd_pre + 
                age + I(age^2) + female + 
                postsecondary_edu +
                party_close + 
                pol_interest_num + 
                factor(election), 
            data = all_panels)

coefs5 <- c(
    "(Intercept)"="(Intercept)", 
    "winner" = "Preferred candidate/party won",
    "stable_voter" = "Stable voter (prev. national election)",
    "stable_intention" = "Stable vote intention (wrt pre-election wave)",
    "swd_pre"="Satisfaction w/ democracy (pre-election wave)", 
    "age" = "Age", 
    "I(age^2)" = "Age (squared)", 
    "female" = "Female", 
    "postsecondary_edu" = "Postsecondary education", 
    "party_close" = "Close to a party",
    "pol_interest_num" = "Political interest"
)
new_rows5 <- create_fe_row(coefs5, 3)

modelsummary(list(lm5_0, lm5_1, lm5_2), coef_map = coefs5, 
             add_rows = new_rows5, fmt = 2, stars = TRUE)
```

# Czech Republic, parliamentary election 1996

```{r}
tar_load(cz_1996)

cz_1996 %>% 
  select(swd_pre, swd_post) %>% 
  table(., useNA = "always")

mean(cz_1996$swd_pre, na.rm = TRUE)
mean(cz_1996$swd_post, na.rm = TRUE)
mean(cz_1996$swd_diff, na.rm = TRUE)
```

## H1
```{r}
cz_lm1_1 <- glm(voted ~ swd_pre + age + I(age^2) + female +
                 postsecondary_edu, 
             data = cz_1996, 
             family = binomial(link = "logit"))
cz_lm1_2 <- glm(voted ~ swd_pre + age + I(age^2) + female + 
                 postsecondary_edu +
                 pol_interest_num + party_close, 
                data = cz_1996, 
                family = binomial(link = "logit"))

tab_model(list(cz_lm1_1, cz_lm1_2))
```


## H2
```{r}
cz_lm2_1 <- glm(voted ~ swd_pre, data = cz_1996 %>% filter(both_waves), 
                family = binomial(link = "logit"))
cz_lm2_2 <- glm(voted ~ swd_post, data = cz_1996 %>% filter(both_waves),
                family = binomial(link = "logit"))
cz_lm2_3 <- glm(voted ~ swd_pre + swd_post, 
                data = cz_1996 %>% filter(both_waves), 
                family = binomial(link = "logit"))

tab_model(list(cz_lm2_1, cz_lm2_2, cz_lm2_3))
```

## H3
```{r}
cz_lm3_1 <- lm(swd_diff ~ voted, data = cz_1996 %>% filter(both_waves))
cz_lm3_2 <- lm(swd_diff ~ voted + swd_pre, data = cz_1996 %>% filter(both_waves))

tab_model(list(cz_lm3_1, cz_lm3_2))
```

## H4
Applicable only to presidential election.

## H5
```{r}
cz_lm5_0 <- lm(swd_diff ~ winner_party + stable_voter + swd_pre, 
            data = cz_1996 %>% filter(both_waves))
cz_lm5_1 <- lm(swd_diff ~ winner_party * stable_voter + swd_pre, 
            data = cz_1996 %>% filter(both_waves))
cz_lm5_2 <- lm(swd_diff ~ winner_party * stable_intention + swd_pre, 
            data = cz_1996 %>% filter(both_waves))

tab_model(list(cz_lm5_0, cz_lm5_1, cz_lm5_2))

cz_lm5_0b <- lm(swd_diff ~ winner_government + stable_voter + swd_pre, 
            data = cz_1996 %>% filter(both_waves))
cz_lm5_1b <- lm(swd_diff ~ winner_government * stable_voter + swd_pre, 
            data = cz_1996 %>% filter(both_waves))
cz_lm5_2b <- lm(swd_diff ~ winner_government * stable_intention + swd_pre, 
            data = cz_1996 %>% filter(both_waves))

tab_model(list(cz_lm5_0b, cz_lm5_1b, cz_lm5_2b))
```

# Czech Republic, 2023 presidential election
```{r}
tar_load(cz_2023)

cz_2023 %>% 
  select(swd_pre, swd_post) %>% 
  table(., useNA = "always")

mean(cz_2023$swd_pre, na.rm = TRUE)
mean(cz_2023$swd_post, na.rm = TRUE)
mean(cz_2023$swd_diff, na.rm = TRUE)
```

## H1
```{r}
cz_lm1_1 <- glm(voted ~ SWD_w2 + age + I(age^2) + female + postsecondary_edu, 
                data = cz_2023, family = binomial(link = "logit"))
cz_lm1_2 <- glm(voted ~ SWD_w2 + age + I(age^2) + female + postsecondary_edu + 
                    pol_knowledge_pct + pol_interest_num + party_close, 
                data = cz_2023, family = binomial(link = "logit"))

tab_model(list(cz_lm1_1, cz_lm1_2))
```

## H2
```{r}

cz_lm2_1 <- glm(voted ~ SWD_w2, data = cz_2023, family = binomial(link = "logit"))
cz_lm2_2 <- glm(voted ~ SWD_w4, data = cz_2023, family = binomial(link = "logit"))
cz_lm2_3 <- glm(voted ~ SWD_w2 + SWD_w4, data = cz_2023, family = binomial(link = "logit"))

tab_model(list(cz_lm2_1, cz_lm2_2, cz_lm2_3))

```

## H3
```{r}
cz_lm3_1 <- lm(swd_diff ~ voted, data = cz_2023)
cz_lm3_2 <- lm(swd_diff ~ voted + SWD_w1, data = cz_2023)

tab_model(list(cz_lm3_1, cz_lm3_2))
```

## H4
```{r}
cz_lm4_1 <- lm(swd_diff ~ candidate_qualified_2nd + SWD_w2, 
               data = cz_2023)
cz_lm4_2 <- lm(swd_diff ~ candidate_qualified_2nd + winner + SWD_w2, 
               data = cz_2023)

tab_model(list(cz_lm4_1, cz_lm4_2))
```

## H5
```{r}
# same_candidate_in_2r
cz_lm5_0 <- lm(swd_diff ~ winner + stable_voter + SWD_w2,
            data = cz_2023)
# cz_lm5_1 <- lm(swd_diff ~ winner * stable_voter + SWD_w1,
#             data = cz_2023)

tab_model(list(cz_lm5_0 #, cz_lm5_1
               ))
```


# Romanian presidential election, 2009
```{r}
tar_load(ro_2009_final)

ro_2009_final %>% 
  select(swd_pre, swd_post) %>% 
  table(., useNA = "always")

mean(ro_2009_final$swd_pre, na.rm = TRUE)
mean(ro_2009_final$swd_post, na.rm = TRUE)
mean(ro_2009_final$swd_diff, na.rm = TRUE)
```

## H1
```{r}
ro_lm1_1 <- glm(voted ~ swd_w1 + age + I(age^2) + female + postsecondary_edu, 
                data = ro_2009_final, 
                family = binomial(link = "logit"))
ro_lm1_2 <- glm(voted ~ swd_w1 + age + I(age^2) + female + postsecondary_edu + 
                    pol_knowledge + pol_interest_num + party_close, 
                data = ro_2009_final, 
                family = binomial(link = "logit"))

tab_model(list(ro_lm1_1, ro_lm1_2))
```

## H2
```{r}

ro_lm2_1 <- glm(voted ~ swd_w1, data = ro_2009_final, 
                family = binomial(link = "logit"))
ro_lm2_2 <- glm(voted ~ swd_w3, data = ro_2009_final, 
                family = binomial(link = "logit"))
ro_lm2_3 <- glm(voted ~ swd_w1 + swd_w3, data = ro_2009_final, 
                family = binomial(link = "logit"))

tab_model(list(ro_lm2_1, ro_lm2_2, ro_lm2_3))

```

## H3
```{r}
ro_lm3_1 <- lm(swd_diff ~ voted, data = ro_2009_final)
ro_lm3_2 <- lm(swd_diff ~ voted + swd_w1, data = ro_2009_final)

tab_model(list(ro_lm3_1, ro_lm3_2))
```

## H4
```{r}
ro_lm4_1 <- lm(swd_diff ~ candidate_qualified_2nd + swd_w1, 
               data = ro_2009_final)
ro_lm4_2 <- lm(swd_diff ~ candidate_qualified_2nd + winner + swd_w1, 
               data = ro_2009_final)

tab_model(list(ro_lm4_1, ro_lm4_2))
```

## H5
```{r}
# same_candidate_in_2r
ro_lm5_0 <- lm(swd_diff ~ winner + stable_voter + swd_w1,
            data = ro_2009_final)
ro_lm5_1 <- lm(swd_diff ~ winner * stable_voter + swd_w1,
            data = ro_2009_final)

tab_model(list(ro_lm5_0, ro_lm5_1))
```

# Romanian parliamentary elections, 2012
```{r}
tar_load(ro_2012_p1_final)
tar_load(ro_2012_all)

ro_2012_all %>% 
  select(swd_pre, swd_post) %>% 
  table(., useNA = "always")

mean(ro_2012_all$swd_pre, na.rm = TRUE)
mean(ro_2012_all$swd_post, na.rm = TRUE)
mean(ro_2012_all$swd_diff_w2, na.rm = TRUE)

```

## H1
```{r}
ro2_lm1_1 <- glm(voted ~ swd_w1 + age + I(age^2) + female + postsecondary_edu, 
                 data = ro_2012_p1_final, 
                 family = binomial(link = "logit"))
ro2_lm1_2 <- glm(voted ~ swd_w1 + age + I(age^2) + female + postsecondary_edu + 
                     pol_interest_num + party_close, 
                 data = ro_2012_p1_final, 
                 family = binomial(link = "logit"))

# ro2_lm1_1b <- glm(voted ~ swd_w2 + age + age^2 + female + postsecondary_edu, 
#                   data = ro_2012_all)

tab_model(list(ro2_lm1_1, ro2_lm1_2))
```

## H2
```{r}

ro2_lm2_1 <- glm(voted ~ swd_w1, data = ro_2012_p1_final, 
                 family = binomial(link = "logit"))
ro2_lm2_2 <- glm(voted ~ swd_w3, data = ro_2012_p1_final, 
                 family = binomial(link = "logit"))
ro2_lm2_3 <- glm(voted ~ swd_w1 + swd_w3, data = ro_2012_p1_final, 
                 family = binomial(link = "logit"))

tab_model(list(ro2_lm2_1, ro2_lm2_2, ro2_lm2_3))

ro2_lm2_1b <- glm(voted ~ swd_w2, data = ro_2012_all, 
                  family = binomial(link = "logit"))
ro2_lm2_2b <- glm(voted ~ swd_w3, data = ro_2012_all, 
                  family = binomial(link = "logit"))
ro2_lm2_3b <- glm(voted ~ swd_w2 + swd_w3, data = ro_2012_all, 
                  family = binomial(link = "logit"))

tab_model(list(ro2_lm2_1b, ro2_lm2_2b, ro2_lm2_3b))

```

## H3
```{r}
ro2_lm3_1 <- lm(swd_diff ~ voted, data = ro_2012_p1_final)
ro2_lm3_2 <- lm(swd_diff ~ voted + swd_w1, data = ro_2012_p1_final)

tab_model(list(ro2_lm3_1, ro2_lm3_2))

ro2_lm3_1b <- lm(swd_diff_w2 ~ voted, data = ro_2012_all)
ro2_lm3_2b <- lm(swd_diff_w2 ~ voted + swd_w2, data = ro_2012_all)

tab_model(list(ro2_lm3_1b, ro2_lm3_2b))

```

## H4
Applicable only for presidential elections.

## H5

```{r}
# same_candidate_in_2r
ro2_lm5_0c <- lm(swd_diff_w2 ~ winner + stable_voter + swd_w2,
            data = ro_2012_all)
ro2_lm5_1c <- lm(swd_diff_w2 ~ winner * stable_voter + swd_w2,
            data = ro_2012_all)

tab_model(list(ro2_lm5_0c, ro2_lm5_1c))
```

```{r}
ro2_lm5_0 <- lm(swd_diff ~ winner + stable_intention + swd_w1,
            data = ro_2012_p1_final)
ro2_lm5_1 <- lm(swd_diff ~ winner * stable_intention + swd_w1,
            data = ro_2012_p1_final)

tab_model(list(ro2_lm5_0, ro2_lm5_1))

```

# Poland, EP election 2019

```{r}
tar_load(pl_2019)

pl_2019 %>% 
  select(swd_pre, swd_post) %>% 
  table(., useNA = "always")

mean(pl_2019$swd_pre, na.rm = TRUE)
mean(pl_2019$swd_post, na.rm = TRUE)
mean(pl_2019$swd_diff, na.rm = TRUE)
```


## H1
```{r}
pl_lm1_1 <- glm(voted ~ swd_pre + age + I(age^2) + female + postsecondary_edu, 
                data = pl_2019, 
                family = binomial(link = "logit"))
pl_lm1_2 <- glm(voted ~ swd_pre + age + I(age^2) + female + postsecondary_edu + 
                    pol_interest_num + party_close, 
                data = pl_2019, 
                family = binomial(link = "logit"))

tab_model(list(pl_lm1_1, pl_lm1_2))
```


## H2
```{r}
pl_lm2_1 <- glm(voted ~ swd_pre, data = pl_2019, 
                family = binomial(link = "logit"))
pl_lm2_2 <- glm(voted ~ swd_post, data = pl_2019, 
                family = binomial(link = "logit"))
pl_lm2_3 <- glm(voted ~ swd_pre + swd_post, data = pl_2019, 
                family = binomial(link = "logit"))

tab_model(list(pl_lm2_1, pl_lm2_2, pl_lm2_3))
```

## H3
```{r}
pl_lm3_1 <- lm(swd_diff ~ voted, data = pl_2019)
pl_lm3_2 <- lm(swd_diff ~ voted + swd_pre, data = pl_2019)

tab_model(list(pl_lm3_1, pl_lm3_2))
```

## H4
Applicable only to presidential election.

## H5
```{r}
pl_lm5_0 <- lm(swd_diff ~ winner_party + stable_voter + swd_pre,
               data = pl_2019)
pl_lm5_1 <- lm(swd_diff ~ winner_party * stable_voter + swd_pre,
               data = pl_2019)

tab_model(list(pl_lm5_0, pl_lm5_1))
```

```{r}
pl_lm5_0b <- lm(swd_diff ~ winner_party + stable_intention + swd_pre,
               data = pl_2019)
pl_lm5_1b <- lm(swd_diff ~ winner_party * stable_intention + swd_pre,
               data = pl_2019)

tab_model(list(pl_lm5_0b, pl_lm5_1b))
```

# Hungary, EP election 2019

```{r}
tar_load(hu_2019)

hu_2019 %>% 
  select(swd_pre, swd_post) %>% 
  table(., useNA = "always")

mean(hu_2019$swd_pre, na.rm = TRUE)
mean(hu_2019$swd_post, na.rm = TRUE)
mean(hu_2019$swd_diff, na.rm = TRUE)
```


## H1
```{r}
hu_lm1_1 <- glm(voted ~ swd_pre + age + I(age^2) + female + postsecondary_edu, 
                data = hu_2019)
hu_lm1_2 <- glm(voted ~ swd_pre + age + I(age^2) + female + postsecondary_edu + 
                    pol_interest_num + party_close, 
                data = hu_2019)

tab_model(list(hu_lm1_1, hu_lm1_2))
```


## H2
```{r}
hu_lm2_1 <- glm(voted ~ swd_pre, data = hu_2019, 
                family = binomial(link = "logit"))
hu_lm2_2 <- glm(voted ~ swd_post, data = hu_2019, 
                family = binomial(link = "logit"))
hu_lm2_3 <- glm(voted ~ swd_pre + swd_post, data = hu_2019, 
                family = binomial(link = "logit"))

tab_model(list(hu_lm2_1, hu_lm2_2, hu_lm2_3))
```

## H3
```{r}
hu_lm3_1 <- lm(swd_diff ~ voted, data = hu_2019)
hu_lm3_2 <- lm(swd_diff ~ voted + swd_pre, data = hu_2019)

tab_model(list(hu_lm3_1, hu_lm3_2))
```

## H4
Applicable only to presidential election.

## H5
```{r}
hu_lm5_0 <- lm(swd_diff ~ winner_party + stable_voter + swd_pre,
               data = hu_2019)
hu_lm5_1 <- lm(swd_diff ~ winner_party * stable_voter + swd_pre,
               data = hu_2019)

tab_model(list(hu_lm5_0, hu_lm5_1))
```

```{r}
hu_lm5_0b <- lm(swd_diff ~ winner_party + stable_intention + swd_pre,
               data = hu_2019)
hu_lm5_1b <- lm(swd_diff ~ winner_party * stable_intention + swd_pre,
               data = hu_2019)

tab_model(list(hu_lm5_0b, hu_lm5_1b))
```

# German Federal election 2017

```{r}
tar_load(de_2017_final)

de_2017_final %>% 
  select(swd_pre, swd_post) %>% 
  table(., useNA = "always")

mean(de_2017_final$swd_pre, na.rm = TRUE)
mean(de_2017_final$swd_post, na.rm = TRUE)
mean(de_2017_final$swd_diff, na.rm = TRUE)
```

## H1
```{r}
de_lm1_1 <- glm(voted ~ swd_pre + age + I(age^2) + female + postsecondary_edu,
                data = de_2017_final, 
                family = binomial(link = "logit"))
de_lm1_2 <- glm(voted ~ swd_pre + age + I(age^2) + female + postsecondary_edu + 
                    pol_interest_num + party_close,
                data = de_2017_final, 
                family = binomial(link = "logit"))

tab_model(list(de_lm1_1, de_lm1_2))
```

## H2
```{r}
de_lm2_1 <- glm(voted ~ swd_pre, data = de_2017_final, 
                family = binomial(link = "logit"))
de_lm2_2 <- glm(voted ~ swd_post, data = de_2017_final, 
                family = binomial(link = "logit"))
de_lm2_3 <- glm(voted ~ swd_pre + swd_post, data = de_2017_final, 
                family = binomial(link = "logit"))

tab_model(list(de_lm2_1, de_lm2_2, de_lm2_3))

```

## H3
```{r}
de_lm3_1 <- lm(swd_diff ~ voted, data = de_2017_final)
de_lm3_2 <- lm(swd_diff ~ voted + swd_pre, data = de_2017_final)

de_lm3_1b <- lm(swd_diff ~ voted, data = de_2017_final %>% 
                    filter(!(kp9_2601 == "Berlin" | kp1_2601 == "Berlin")))
de_lm3_2b <- lm(swd_diff ~ voted + swd_pre, data = de_2017_final %>% 
                    filter(!(kp9_2601 == "Berlin" | kp1_2601 == "Berlin")))

tab_model(list(de_lm3_1, de_lm3_2, de_lm3_1b, de_lm3_2b))

```

## H5
```{r}
de_lm5_0 <- lm(swd_diff ~ winner_party + stable_voter + swd_pre,
               data = de_2017_final)
de_lm5_1 <- lm(swd_diff ~ winner_party * stable_voter + swd_pre,
               data = de_2017_final)
de_lm5_0b <- lm(swd_diff ~ winner_party + stable_voter + swd_pre,
               data = de_2017_final %>% 
                   filter(!(kp9_2601 == "Berlin" | kp1_2601 == "Berlin")))
de_lm5_1b <- lm(swd_diff ~ winner_party * stable_voter + swd_pre,
               data = de_2017_final %>% 
                   filter(!(kp9_2601 == "Berlin" | kp1_2601 == "Berlin")))

tab_model(list(de_lm5_0, de_lm5_1, de_lm5_0b, de_lm5_1b))
```

# Checks

```{r}
cz_1996 %>% 
    count(vote_previous_nat_election, vote_choice, stable_voter, 
          sort = TRUE) %>% 
    DT::datatable()

ro_2012_all %>% 
    count(vote_previous_nat_election, vote_choice, stable_voter, 
          sort = TRUE) %>% 
    DT::datatable()

pl_2019 %>% 
    filter(!is.na(swd_diff)) %>% 
    count(vote_previous_nat_election, vote_choice, stable_voter, 
          sort = TRUE) %>% 
    DT::datatable()

hu_2019 %>% 
    filter(!is.na(swd_diff)) %>% 
    count(vote_previous_nat_election, vote_choice, stable_voter, 
          sort = TRUE) %>% 
    DT::datatable()

de_2017_final %>% 
    filter(!is.na(swd_diff)) %>% 
    count(vote_previous_nat_election, vote_choice, stable_voter, 
          sort = TRUE) %>% 
    DT::datatable()
```


