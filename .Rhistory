mutate(prez_vote_type = case_when(
PRES2023CAND1r_w3 == "nevolič" &
PRES2023CAND2r_w4 == "nevolič" ~ "abstainer",
PRES2023CAND1r_w3 == "Petr Pavel" &
PRES2023CAND2r_w4 == "Petr Pavel" ~ "full winner",
PRES2023CAND1r_w3 == "Andrej Babiš" &
PRES2023CAND2r_w4 == "Andrej Babiš" ~ "full loser",
PRES2023CAND2r_w4 == "Petr Pavel" ~ "partial winner",
PRES2023CAND2r_w4 == "Andrej Babiš" ~ "partial loser",
TRUE ~ "abstainer"
)) %>%
mutate(prez_vote_type = factor(
prez_vote_type,
levels = c("abstainer",
"full winner",
"partial winner",
"full loser",
"partial loser"))) %>%
mutate(across(c("swd_pre", "swd_post", "pol_interest_num",
"age", "SWD_w1", "SWD_w4"),
normalize_scale),
swd_diff = swd_post - swd_pre)
r2 <- function(null_model, model){
round(1 - as.numeric(logLik(model)) /
as.numeric(logLik(null_model)), 2)
}
cz_2023_all_waves_resp$SWD_w1
t1
ggeffect(t1, "SWD_w1")
glm(voted_1r ~ SWD_w1 + SWD_w4,
data = cz_2023_all_waves_resp,
family = binomial(link = "logit"),
weights = weight_turnout) -> t1
summary(t1)
ggeffect(t1, "SWD_w1")
library(marginaleffects)
avg_comparisons(t1, variables = SWD_w1)
avg_comparisons(t1, variables = list(SWD_w1))
avg_comparisons(t1, variables = list("SWD_w1"))
avg_comparisons(t1)
install.packages("margins")
library(margins)
margins(t1)
margins(ce2_round1, "SWD_w1")
ce2_round1 <- glm(voted_1r ~ SWD_w1 + female + age +
postsecondary_edu + duty_to_vote +
pol_interest_num + pol_knowledge + party_close,
data = cz_2023_all_waves_resp,
family = binomial(link = "logit"),
weights = weight_turnout) %>%
coeftest(., vcov = vcovHC(., type="HC1"))
margins(ce2_round1, "SWD_w1")
margins
margins:::margins.glm
ce2_round1_ame <- glm(voted_1r ~ SWD_w1 + female + age +
postsecondary_edu + duty_to_vote +
pol_interest_num + pol_knowledge + party_close,
data = cz_2023_all_waves_resp,
family = binomial(link = "logit"),
weights = weight_turnout)
avg_slopes(ce2_round1_ame,
variables = "SWD_w1")
avg_slopes(ce2_round1_ame,
variables = "SWD_w1",
vcov = "HC2")
avg_slopes(ce2_round1_ame,
variables = "SWD_w1"#,
#vcov = "HC2"
)
?lm_robust
ce2_round2_ame <- glm(voted_2r ~ SWD_w1 + female +
age + postsecondary_edu + duty_to_vote +
pol_interest_num + pol_knowledge + party_close,
data = cz_2023_all_waves_resp,
family = binomial(link = "logit"),
weights = weight_turnout)
avg_slopes(ce2_round2_ame,
variables = "SWD_w1",
vcov = "HC1")
ce2_round1_ame <- glm(voted_1r ~ SWD_w1 + female + age +
postsecondary_edu + duty_to_vote +
pol_interest_num + pol_knowledge + party_close,
data = cz_2023_all_waves_resp,
family = binomial(link = "logit"),
weights = weight_turnout)
avg_slopes(ce2_round1_ame,
variables = "SWD_w1",
vcov = "HC1")
avg_slopes(ce2_round2_ame,
variables = "SWD_w1",
vcov = "HC1")
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(lme4)
library(boot)
library(dplyr)
library(sjPlot)
library(lmtest)
library(targets)
library(ggplot2)
library(ggeffects)
library(modelsummary)
library(marginaleffects)
options("modelsummary_format_numeric_latex" = "plain")
source("R/funs.R")
tar_load(cz_2023_models)
tar_load(all_panels)
cz_2023 <- cz_2023_models
mean_swd <- function(data, indices){
dt <- data[indices, ]
c(
mean(dt$SWD_w1, na.rm = TRUE),
mean(dt$SWD_w2, na.rm = TRUE),
mean(dt$SWD_w3, na.rm = TRUE),
mean(dt$SWD_w4, na.rm = TRUE),
mean(dt$SWD_w5, na.rm = TRUE)
)
}
tar_make()
?vcovHC
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(lme4)
library(boot)
library(dplyr)
library(sjPlot)
library(lmtest)
library(targets)
library(ggplot2)
library(sandwich)
library(ggeffects)
library(modelsummary)
library(marginaleffects)
options("modelsummary_format_numeric_latex" = "plain")
source("R/funs.R")
tar_load(cz_2023_models)
tar_load(all_panels)
all_panels_both_waves %>%
summarise(across(c("voted", "swd_pre", "swd_post", "female",
"age", "postsecondary_edu",
"pol_interest_num", "party_close"),
mean))
list(mean, sd, min, max))
all_panels_both_waves %>%
summarise(across(c("voted", "swd_pre", "swd_post", "female",
"age", "postsecondary_edu",
"pol_interest_num", "party_close"),
mean))
all_panels_both_waves %>%
summarise(across(c("voted", "swd_pre", "swd_post", "female",
"age", "postsecondary_edu",
"pol_interest_num", "party_close"),
mean)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "mean")
summarise_data <- function(df, vars){
mean <- df %>%
summarise(across(vars, mean)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "mean")
sd <- df %>%
summarise(across(vars, sd)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "sd")
q25 <- df %>%
summarise(across(vars, ~quantile(.x, 0.25))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q25")
q50 <- df %>%
summarise(across(vars, ~quantile(.x, 0.5))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q50")
q75 <- df %>%
summarise(across(vars, ~quantile(.x, 0.75))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q75")
min <- df %>%
summarise(across(vars, min)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "min")
min <- df %>%
summarise(across(vars, max)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "max")
bind_cols(
min, max, mean, sd, q25, q50, q75
)
}
summarise_data <- function(df, vars){
mean <- df %>%
summarise(across(vars, mean)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "mean")
sd <- df %>%
summarise(across(vars, sd)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "sd")
q25 <- df %>%
summarise(across(vars, ~quantile(.x, 0.25))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q25")
q50 <- df %>%
summarise(across(vars, ~quantile(.x, 0.5))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q50")
q75 <- df %>%
summarise(across(vars, ~quantile(.x, 0.75))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q75")
min <- df %>%
summarise(across(vars, min)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "min")
min <- df %>%
summarise(across(vars, max)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "max")
bind_cols(
min, max, mean, sd, q25, q50, q75
)
}
all_panels_both_waves %>%
summarise_data(c("voted", "swd_pre", "swd_post", "female",
"age", "postsecondary_edu",
"pol_interest_num", "party_close"))
summarise_data <- function(df, vars){
mean <- df %>%
summarise(across(vars, mean)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "mean")
sd <- df %>%
summarise(across(vars, sd)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "sd")
q25 <- df %>%
summarise(across(vars, ~quantile(.x, 0.25))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q25")
q50 <- df %>%
summarise(across(vars, ~quantile(.x, 0.5))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q50")
q75 <- df %>%
summarise(across(vars, ~quantile(.x, 0.75))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q75")
min <- df %>%
summarise(across(vars, min)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "min")
min <- df %>%
summarise(across(vars, max)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "max")
bind_cols(
list(min, max, mean, sd, q25, q50, q75)
)
}
all_panels_both_waves %>%
summarise_data(c("voted", "swd_pre", "swd_post", "female",
"age", "postsecondary_edu",
"pol_interest_num", "party_close"))
summarise_data <- function(df, vars){
mean_df <- df %>%
summarise(across(vars, mean)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "mean")
sd_df <- df %>%
summarise(across(vars, sd)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "sd")
q25_df <- df %>%
summarise(across(vars, ~quantile(.x, 0.25))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q25")
q50_df <- df %>%
summarise(across(vars, ~quantile(.x, 0.5))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q50")
q75_df <- df %>%
summarise(across(vars, ~quantile(.x, 0.75))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q75")
min_df <- df %>%
summarise(across(vars, min)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "min")
max_df <- df %>%
summarise(across(vars, max)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "max")
bind_cols(
list(min_df, max_df, mean_df, sd_df, q25_df, q50_df, q75_df)
)
}
all_panels_both_waves %>%
summarise_data(c("voted", "swd_pre", "swd_post", "female",
"age", "postsecondary_edu",
"pol_interest_num", "party_close"))
summarise_data <- function(df, vars){
mean_df <- df %>%
summarise(across(vars, mean)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "mean")
sd_df <- df %>%
summarise(across(vars, sd)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "sd")
q25_df <- df %>%
summarise(across(vars, ~quantile(.x, 0.25))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q25")
q50_df <- df %>%
summarise(across(vars, ~quantile(.x, 0.5))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q50")
q75_df <- df %>%
summarise(across(vars, ~quantile(.x, 0.75))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q75")
min_df <- df %>%
summarise(across(vars, min)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "min")
max_df <- df %>%
summarise(across(vars, max)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "max")
purrr::reduce(
list(min_df, max_df, mean_df, sd_df, q25_df, q50_df, q75_df),
full_join
)
}
all_panels_both_waves %>%
summarise_data(c("voted", "swd_pre", "swd_post", "female",
"age", "postsecondary_edu",
"pol_interest_num", "party_close"))
install.packages("Hmisc")
?Hmisc::wtd.var
summarise_data <- function(df, vars){
mean_df <- df %>%
summarise(across(vars, mean))%>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "mean")
sd_df <- df %>%
summarise(across(vars, sd)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "sd")
q25_df <- df %>%
summarise(across(vars, ~quantile(.x, 0.25))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q25")
q50_df <- df %>%
summarise(across(vars, ~quantile(.x, 0.5))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q50")
q75_df <- df %>%
summarise(across(vars, ~quantile(.x, 0.75))) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "q75")
min_df <- df %>%
summarise(across(vars, min)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "min")
max_df <- df %>%
summarise(across(vars, max)) %>%
tidyr::pivot_longer(., cols = everything(),
names_to = "variable",
values_to = "max")
purrr::reduce(
list(min_df, max_df, mean_df, sd_df, q25_df, q50_df, q75_df),
full_join
)
}
all_panels_both_waves %>%
summarise_data(c("voted", "swd_pre", "swd_post", "female",
"age", "postsecondary_edu",
"pol_interest_num", "party_close"))
all_panels_both_waves %>%
summarise_data(c("voted", "swd_pre", "swd_post", "female",
"age", "postsecondary_edu",
"pol_interest_num", "party_close")) %>%
mutate(across(where(is.numeric), ~round(.x, 2)))
install.packages("gtsummary")
library(gtsummary)
all_panels %>%
tbl_summary()
tar_make()
tar_make()
swd4_round1
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(lme4)
library(boot)
library(dplyr)
library(sjPlot)
library(lmtest)
library(targets)
library(ggplot2)
library(sandwich)
library(estimatr)
library(ggeffects)
library(modelsummary)
library(marginaleffects)
options("modelsummary_format_numeric_latex" = "plain")
source("R/funs.R")
tar_load(cz_2023_models)
tar_load(all_panels)
ggeffect(swd4_round1, "prez_vote_type") %>%
plot() +
labs(title = "Predicted SWD change by voter type",
x = "Voter type",
y = "SWD change",
caption = "Using model 3 from table above")
swd4_round1
ggeffect(swd4_round1, "prez_vote_type")
ggeffect(swd4_round1, "prez_vote_typefull winner")
ggeffect(swd4_round1)
ggeffect(swd4_round1, terms = ~prez_vote_type)
ggeffect(swd4_round1, terms = "swd_pre")
swd4_round1
class(swd4_round1)
swd4_round1 <- lm_robust(swd_diff ~ prez_vote_type + swd_pre +
female + age +
postsecondary_edu + pol_interest_num +
pol_knowledge + party_close + duty_to_vote,
data = cz_2023_all_waves_resp,
weights = weight_turnout,
se_type = "stata")
ggeffect(swd4_round1, "prez_vote_type") %>%
plot() +
labs(title = "Predicted SWD change by voter type",
x = "Voter type",
y = "SWD change",
caption = "Using model 3 from table above")
ggeffect(swd4_round1, "prez_vote_type")
?avg_slopes
mod <- glm(am ~ hp * wt, data = mtcars, family = binomial)
mod
avg_slopes(mod, by = TRUE)
avg_slopes(ce2_round2_ame,
variables = "SWD_w1",
vcov = "HC1",
wts = "weight_turnout")
avg_slopes(ce2_round1_ame,
variables = "SWD_w1",
vcov = "HC1",
wts = "weight_turnout")
library(ggplot2)
df1 = data.frame(person = c("person1", "person2", "person3"),
variable = "variable1",
value = c(0.5, 0.3, 0.2))
df1
df1 = data.frame(person = c("person1", "person2", "person3"),
variable = "variable1",
var1 = c(0.5, 0.3, 0.2))
df2 = data.frame(person = c("person1", "person2", "person3"),
variable = "variable2",
value = c(-0.3, -0.1, -0.4))
starwars %>%
count(gender)
starwars %>%
ggplot(., aes(x = gender, y = n)) +
geom_bar(stat = "count")
starwars %>%
ggplot(., aes(x = gender)) +
geom_bar(stat = "count")
starwars %>%
ggplot(., aes(x = gender)) +
geom_bar(stat = "count") +
theme_paq()
library(paqr)
library(ggplot2)
